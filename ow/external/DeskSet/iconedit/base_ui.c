/*
 * base_ui.c - User interface object initialization functions.
 * This file was generated by `gxv' from `./base.G'.
 * DO NOT EDIT BY HAND.
 */

#include <stdio.h>
#include <sys/param.h>
#include <sys/types.h>
#include <X11/X.h>
#include <xview/xview.h>
#include <xview/canvas.h>
#include <xview/icon_load.h>
#include <xview/notify.h>
#include <xview/panel.h>
#include <xview/scrollbar.h>
#include <xview/svrimage.h>
#include <xview/termsw.h>
#include <xview/text.h>
#include <xview/tty.h>
#include <xview/xv_xrect.h>
#include <xview/cms.h>
#include <xview/notify.h>
#include <xview/notice.h>
#include "gcm.h"
#include "base_gui.h"
#include "file_gui.h"
#include "tooltalk.h"

#define DEFAULT_CANVAS_SIZE	513
#define DEFAULT_PREVIEW_SIZE	140

#define GRID_OFF 0
#define GRID_ON 1

extern	int	canvas_dimension;
extern	char	cmdline_args[];
extern int	undos_allowed;
extern int	redos_allowed;
extern int	Edited;
extern char	*gettext();
extern char     *get_truncated_file_name();
extern int      grid_status;
extern int      icon_height, icon_width;

Menu temp_menu;
Panel temp_obj;

/*
 * Create object `bw_file_menu' in the specified instance.

 */
Xv_opaque
base_bw_file_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	extern Menu_item	show_file_popup_load();
	extern Menu_item	save_menu_proc();
	extern Menu_item	show_file_popup_save();
	extern Menu_item	show_print_popup();
	Xv_opaque	obj;
	
	obj = xv_create(XV_NULL, MENU_COMMAND_MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Load...") ,
			MENU_GEN_PROC, show_file_popup_load,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Open",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:LoadMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Save") ,
			MENU_GEN_PROC, save_menu_proc,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Save",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:SaveMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Save As..") ,
			MENU_GEN_PROC, show_file_popup_save,
			XV_HELP_DATA, "iconedit:SaveAsMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Print...") ,
			MENU_GEN_PROC, show_print_popup,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Print",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:PrintMenuItem",
			NULL,
		MENU_DEFAULT, 1,
		NULL);
#ifdef KYBDACC
	 xv_set( ((base_window_objects *)ip)->window, FRAME_MENU_ADD, obj, NULL);
#endif  /* KYBDACC */
	return obj;
}

/*
 * Create object `bw_view_menu' in the specified instance.
 */
Xv_opaque
base_bw_view_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	extern Menu_item	grid_toggle();
	Xv_opaque	obj;
	
	obj = xv_create(XV_NULL, MENU_COMMAND_MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Grid On"),
			MENU_GEN_PROC, grid_toggle,
			XV_HELP_DATA, "iconedit:GridMenuItem",
			NULL,
		MENU_DEFAULT, 1,
		NULL);
	return obj;
}

Xv_opaque
base_bw_props_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(XV_NULL, MENU_COMMAND_MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Format") ,
			MENU_PULLRIGHT, base_bw_format_menu_create(ip, NULL),
			XV_HELP_DATA, "iconedit:PropsMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Size") ,
			MENU_PULLRIGHT, base_bw_size_menu_create(ip, NULL),
			XV_HELP_DATA, "iconedit:SizeMenuItem",
			NULL,
		MENU_DEFAULT, 1,
		NULL);
	return obj;
}

Xv_opaque
base_bw_format_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	extern Menu		save_file();
	extern Menu_item	props_icon();
	extern Menu_item	props_xbm();
	extern Menu_item	props_c_xpm();
	extern Menu_item	props_m_xpm();
	Xv_opaque	obj;
	
	obj = xv_create(XV_NULL, MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_GEN_PROC, save_file,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("XView Icon") ,
			MENU_GEN_PROC, props_icon,
			XV_HELP_DATA, "iconedit:XvIconMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("X Bitmap") ,
			MENU_GEN_PROC, props_xbm,
			XV_HELP_DATA, "iconedit:XBMMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Color X Pixmap") ,
			MENU_GEN_PROC, props_c_xpm,
			XV_HELP_DATA, "iconedit:ColorXPMMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Mono X Pixmap") ,
			MENU_GEN_PROC, props_m_xpm,
			XV_HELP_DATA, "iconedit:MonoXPMMenuItem",
			NULL,
		NULL);
	return obj;
}

/*
 * Create object `bw_edit_menu' in the specified instance.

 */
Xv_opaque
base_bw_edit_menu_create(ip, owner)
	caddr_t		*ip; 
	Xv_opaque	owner;
{
	extern Menu_item	undo();
	extern Menu_item	redo();
	extern Menu_item	clear();
	extern Menu_item	cut();
	extern Menu_item	copy();
	extern Menu_item	paste();
	extern Menu_item	invert();
	Xv_opaque	obj;
	
	obj = xv_create(NULL, MENU_COMMAND_MENU,
		XV_KEY_DATA, INSTANCE, ip,
/*		MENU_TITLE_ITEM,
			MENU_TITLE, gettext("Edit"),
			NULL,
*/
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Undo") ,
			MENU_GEN_PROC, undo,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Undo",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:UndoMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Redo") ,
			MENU_GEN_PROC, redo,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Redo",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:RedoMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Clear") ,
			MENU_GEN_PROC, clear,
			XV_HELP_DATA, "iconedit:ClearMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Cut") ,
			MENU_GEN_PROC, cut,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Cut",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:CutMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Copy") ,
			MENU_GEN_PROC, copy,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Copy",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:CopyMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Paste") ,
			MENU_GEN_PROC, paste,
#ifdef KYBDACC
			MENU_ACCELERATOR, "coreset Paste",
#endif /* KYBDACC */
			XV_HELP_DATA, "iconedit:PasteMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Invert") ,
			MENU_GEN_PROC, invert,
			XV_HELP_DATA, "iconedit:InvertMenuItem",
			NULL,
		MENU_DEFAULT, 2,
		MENU_GEN_PIN_WINDOW, (Xv_opaque) ip[0], gettext("Edit"), 
		NULL);
	return obj;
}

/*
 * Create object `bw_grid_menu' in the specified instance.

 */
Xv_opaque
base_bw_grid_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	extern Menu_item	grid_toggle();
	extern Menu_item	grid_off();
	Xv_opaque	obj;
	
	obj = xv_create(XV_NULL, MENU_COMMAND_MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Toggle") ,
			MENU_GEN_PROC, grid_toggle,
			XV_HELP_DATA, "iconedit:ToggleMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("Off") ,
			MENU_GEN_PROC, grid_off,
			XV_HELP_DATA, "iconedit:ToggleOffMenuItem",
			NULL,
		MENU_DEFAULT, 1,
		NULL);
	return obj;
}

/*
 * Create object `bw_size_menu' in the specified instance.

 */
Xv_opaque
base_bw_size_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	extern Menu_item	size_16();
	extern Menu_item	size_32();
	extern Menu_item	size_48();
	extern Menu_item	size_64();
	extern Menu_item	size_128();
	Xv_opaque	obj;
	
	obj = xv_create(XV_NULL, MENU_COMMAND_MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("16 (Cursor)") ,
			MENU_GEN_PROC, size_16,
			XV_HELP_DATA, "iconedit:16xMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("32 (File manager icon)") ,
			MENU_GEN_PROC, size_32,
			XV_HELP_DATA, "iconedit:32xMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING, "48",
			MENU_GEN_PROC, size_48,
			XV_HELP_DATA, "iconedit:48xMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING,  gettext("64 (Tool Icon)") ,
			MENU_GEN_PROC, size_64,
			XV_HELP_DATA, "iconedit:64xMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_STRING, "128",
			MENU_GEN_PROC, size_128,
			XV_HELP_DATA, "iconedit:128xMenuItem",
			NULL,
		MENU_DEFAULT, 4,
		NULL);
	return obj;
}

/*
 * Create object `palette_menu' in the specified instance.

 */
Xv_opaque
base_palette_menu_create(ip, owner)
	caddr_t		*ip;
	Xv_opaque	owner;
{
	extern Menu		color_selection();
	extern Menu_item	select_black();
	extern Menu_item	select_red();
	extern Menu_item	select_green();
	extern Menu_item	select_blue();
	extern Menu_item	select_orange();
	extern Menu_item	select_yellow();
	extern Menu_item	select_violet();
	extern Menu_item	select_brown();
	extern Menu_item	select_white();
	Xv_opaque	obj;
	Xv_opaque		palette_menu_image0;
	static unsigned short	palette_menu_bits0[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image1;
	static unsigned short	palette_menu_bits1[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image2;
	static unsigned short	palette_menu_bits2[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image3;
	static unsigned short	palette_menu_bits3[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image4;
	static unsigned short	palette_menu_bits4[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image5;
	static unsigned short	palette_menu_bits5[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image6;
	static unsigned short	palette_menu_bits6[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image7;
	static unsigned short	palette_menu_bits7[] = {
#include "swatch_black.icon16"
	};
	Xv_opaque		palette_menu_image8;
	static unsigned short	palette_menu_bits8[] = {
#include "swatch_black.icon16"
	};
	
	gcm_initialize_colors(owner, NULL, NULL);
	palette_menu_image0 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits0,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image1 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits1,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image2 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits2,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image3 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits3,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image4 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits4,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image5 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits5,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image6 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits6,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image7 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits7,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	palette_menu_image8 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, palette_menu_bits8,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(XV_NULL, MENU_CHOICE_MENU,
		XV_KEY_DATA, INSTANCE, ip,
		MENU_NCOLS, 3,
		MENU_GEN_PROC, color_selection,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image0,
			MENU_COLOR, gcm_color_index( gettext("black") ),
			MENU_GEN_PROC, select_black,
			XV_HELP_DATA, "iconedit:BlackMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image1,
			MENU_COLOR, gcm_color_index( gettext("red") ),
			MENU_GEN_PROC, select_red,
			XV_HELP_DATA, "iconedit:RedMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image2,
			MENU_COLOR, gcm_color_index( gettext("green") ),
			MENU_GEN_PROC, select_green,
			XV_HELP_DATA, "iconedit:GreenMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image3,
			MENU_COLOR, gcm_color_index( gettext("blue") ),
			MENU_GEN_PROC, select_blue,
			XV_HELP_DATA, "iconedit:BlueMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image4,
			MENU_COLOR, gcm_color_index( gettext("orange") ),
			MENU_GEN_PROC, select_orange,
			XV_HELP_DATA, "iconedit:OrangeMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image5,
			MENU_COLOR, gcm_color_index( gettext("yellow") ),
			MENU_GEN_PROC, select_yellow,
			XV_HELP_DATA, "iconedit:YellowMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image6,
			MENU_COLOR, gcm_color_index( gettext("violet") ),
			MENU_GEN_PROC, select_violet,
			XV_HELP_DATA, "iconedit:VioletMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image7,
			MENU_COLOR, gcm_color_index( gettext("brown") ),
			MENU_GEN_PROC, select_brown,
			XV_HELP_DATA, "iconedit:BrownMenuItem",
			NULL,
		MENU_ITEM,
			XV_KEY_DATA, INSTANCE, ip,
			MENU_IMAGE, palette_menu_image8,
			MENU_COLOR, gcm_color_index( gettext("white") ),
			MENU_GEN_PROC, select_white,
			XV_HELP_DATA, "iconedit:WhiteMenuItem",
			NULL,
		NULL);
	return obj;
}

/*
 * Initialize an instance of object `window'.
 */
base_window_objects *
base_window_objects_initialize(ip, owner)
	base_window_objects	*ip;
	Xv_opaque	owner;
{
	if (!ip && !(ip = (base_window_objects *) calloc(1, sizeof (base_window_objects))))
		return (base_window_objects *) NULL;
	if (!ip->window)
		ip->window = base_window_window_create(ip, owner);
	if (!ip->main_control)
		ip->main_control = base_window_main_control_create(ip, ip->window);
	if (!ip->file_bt)
		ip->file_bt = base_window_file_bt_create(ip, ip->main_control);
	if (!ip->view_bt)
		ip->view_bt = base_window_view_bt_create(ip, ip->main_control);
	temp_menu = base_bw_edit_menu_create(ip, ip->main_control);
#ifdef KYBDACC
	 xv_set( ip->window, FRAME_MENU_ADD, temp_menu, NULL);
#endif  /* KYBDACC */
	if (!ip->edit_bt)
		ip->edit_bt = base_window_edit_bt_create(ip, ip->main_control);
	if (!ip->props_bt)
		ip->props_bt = base_window_props_bt_create(ip, ip->main_control);
	if (!ip->palette_bt)
		ip->palette_bt = base_window_palette_bt_create(ip, ip->main_control);

	window_fit(ip->main_control);

	if (!ip->strip_control)
		ip->strip_control = base_window_strip_control_create(ip, ip->window);

	xv_set(ip->strip_control, 
		WIN_BELOW, 	ip->main_control, 
		XV_X, 		0, 
		0);

	if (!ip->brush_setting)
		ip->brush_setting = base_window_brush_setting_create(ip, ip->strip_control);
	if (!ip->fill_setting)
		ip->fill_setting = base_window_fill_setting_create(ip, ip->strip_control);
	if (!ip->color_mono_setting)
		ip->color_mono_setting = base_window_color_mono_setting_create(ip, ip->strip_control);
	if (!ip->move_left_bt)
		ip->move_left_bt = base_window_move_left_bt_create(ip, ip->strip_control);
	if (!ip->move_right_bt)
		ip->move_right_bt = base_window_move_right_bt_create(ip, ip->strip_control);
	if (!ip->move_up_bt)
		ip->move_up_bt = base_window_move_up_bt_create(ip, ip->strip_control);
	if (!ip->move_down_bt)
		ip->move_down_bt = base_window_move_down_bt_create(ip, ip->strip_control);
	if (!ip->horzflip_bt)
		ip->horzflip_bt = base_window_horzflip_bt_create(ip, ip->strip_control);
	if (!ip->vertflip_bt)
		ip->vertflip_bt = base_window_vertflip_bt_create(ip, ip->strip_control);
	if (!ip->counter_rot_bt)
		ip->counter_rot_bt = base_window_counter_rot_bt_create(ip, ip->strip_control);
	if (!ip->clock_rot_bt)
		ip->clock_rot_bt = base_window_clock_rot_bt_create(ip, ip->strip_control);
	if (!ip->preview_canvas)
		ip->preview_canvas = base_window_preview_canvas_create(ip, ip->window);


	ds_center_items(ip->strip_control, 0, 
			ip->brush_setting, ip->fill_setting, 
			ip->color_mono_setting, 
			0);

	ds_center_items(ip->strip_control, 2, 
		ip->move_left_bt, ip->move_right_bt, ip->move_up_bt, 
		ip->move_down_bt, ip->horzflip_bt, ip->vertflip_bt, 
		ip->counter_rot_bt, ip->clock_rot_bt, 
		0);

	window_fit(ip->strip_control);


        /* Make sure the strip control area is at least as tall as the preview
           area needs to be. */

	if (xv_get(ip->strip_control, XV_HEIGHT) < DEFAULT_PREVIEW_SIZE) {
		xv_set(ip->strip_control, 
			XV_HEIGHT, DEFAULT_PREVIEW_SIZE,
			0);
        }

	if (!ip->big_bit_canvas)
		ip->big_bit_canvas = base_window_big_bit_canvas_create(ip, ip->window);

        /* If the main control panel is really wide, we first fix the strip
           control plus the preview window to be that width */

	if ((xv_get(ip->strip_control, XV_WIDTH) + DEFAULT_PREVIEW_SIZE) < xv_get(ip->main_control, XV_WIDTH))
	{
		xv_set(ip->strip_control, 
			XV_WIDTH, xv_get(ip->main_control, XV_WIDTH) - DEFAULT_PREVIEW_SIZE, 
			0);
	}

        /* If the preview area plus the strip control is less than the minimum
           canvas size, then we bump the strip area to be the same. */

	if ((xv_get(ip->strip_control, XV_WIDTH) + DEFAULT_PREVIEW_SIZE) < DEFAULT_CANVAS_SIZE)
	{
		xv_set(ip->strip_control, 
			XV_WIDTH, DEFAULT_CANVAS_SIZE - DEFAULT_PREVIEW_SIZE, 
			0);
	}
	else
	{
		xv_set(ip->big_bit_canvas,
			XV_WIDTH, xv_get(ip->strip_control, XV_WIDTH) + DEFAULT_PREVIEW_SIZE,
			XV_HEIGHT, xv_get(ip->strip_control, XV_WIDTH) + DEFAULT_PREVIEW_SIZE,
			0);

		canvas_dimension = xv_get(ip->strip_control, XV_WIDTH) + DEFAULT_PREVIEW_SIZE;
	}

	ds_center_items(ip->strip_control, 0, 
			ip->brush_setting, ip->fill_setting, 
			ip->color_mono_setting, 
			0);

	ds_center_items(ip->strip_control, 2, 
		ip->move_left_bt, ip->move_right_bt, ip->move_up_bt, 
		ip->move_down_bt, ip->horzflip_bt, ip->vertflip_bt, 
		ip->counter_rot_bt, ip->clock_rot_bt, 
		0);

	xv_set(ip->preview_canvas,
		WIN_RIGHT_OF, ip->strip_control,
		WIN_BELOW,      ip->main_control,
		0);


	xv_set(ip->big_bit_canvas,
		WIN_BELOW,	ip->preview_canvas,
		WIN_X,		0,
		0);

	xv_set(ip->main_control,
		XV_WIDTH,	WIN_EXTEND_TO_EDGE,
		0);

	window_fit(ip->window);

	return ip;
}

/*
 * Create object `window' in the specified instance.

 */
Xv_opaque
base_window_window_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	Notify_value	iconedit_destroy_proc();
        Notify_value    iconedit_interpose_proc();
	Xv_opaque		window_image;
	static unsigned short	window_bits[] = {
#include "iconedit.icon"
	};
	Xv_opaque		window_image_mask;
	static unsigned short	window_mask_bits[] = {
#include "iconedit.mask"
	};
	
	window_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, window_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 64,
		XV_HEIGHT, 64,
		NULL);
	window_image_mask = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, window_mask_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 64,
		XV_HEIGHT, 64,
		NULL);
	obj = xv_create(owner, FRAME,
		XV_KEY_DATA, INSTANCE, ip,
		FRAME_CLOSED, FALSE,
		FRAME_SHOW_FOOTER, TRUE,
		FRAME_SHOW_RESIZE_CORNER, FALSE,
		WIN_CMD_LINE, cmdline_args,
#ifdef OW_I18N
		WIN_USE_IM, FALSE,
#endif
		FRAME_ICON, xv_create(XV_NULL, ICON,
			ICON_IMAGE, window_image,
			ICON_MASK_IMAGE, window_image_mask,
			ICON_TRANSPARENT, TRUE,
			XV_LABEL, gettext("iconedit"),
			WIN_RETAINED, TRUE,
			NULL),
		NULL);

	notify_interpose_destroy_func((Notify_client) obj, (Notify_func) iconedit_destroy_proc);
        notify_interpose_event_func( ( Notify_client)obj, ( Notify_func )iconedit_interpose_proc, NOTIFY_SAFE );


	return obj;
}

/*
 * Create object `main_control' in the specified instance.

 */
Xv_opaque
base_window_main_control_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL,
		XV_KEY_DATA, INSTANCE, ip,
		XV_X, 0,
		XV_Y, 0,
		XV_WIDTH, WIN_EXTEND_TO_EDGE,
		WIN_BORDER, FALSE,
		XV_HELP_DATA, "iconedit:Panel",
		NULL);
	return obj;
}

/*
 * Create object `file_bt' in the specified instance.

 */
Xv_opaque
base_window_file_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LABEL_STRING,  gettext("File") ,
		PANEL_ITEM_MENU, base_bw_file_menu_create((caddr_t *) ip, NULL),
		XV_HELP_DATA, "iconedit:FileButton",
		NULL);
	return obj;
}

/*
 * Create object `view_bt' in the specified instance.

 */
Xv_opaque
base_window_view_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LABEL_STRING,  gettext("View") ,
		PANEL_ITEM_MENU, base_bw_view_menu_create((caddr_t *) ip, NULL),
		XV_HELP_DATA, "iconedit:ViewButton",
		NULL);
	return obj;
}

/*
 * Create object `edit_bt' in the specified instance.

 */
Xv_opaque
base_window_edit_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LABEL_STRING,  gettext("Edit") ,
		PANEL_ITEM_MENU, temp_menu,
		XV_HELP_DATA, "iconedit:EditButton",
		NULL);
	return obj;
}

Xv_opaque
base_window_props_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LABEL_STRING,  gettext("Properties") ,
		PANEL_ITEM_MENU, base_bw_props_menu_create((caddr_t *) ip, NULL),
		XV_HELP_DATA, "iconedit:PropsButton",
		NULL);
	return obj;
}

/*
 * Create object `palette_bt' in the specified instance.

 */
Xv_opaque
base_window_palette_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		show_palette();
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LABEL_STRING,  gettext("Palette...") ,
		PANEL_EVENT_PROC, show_palette,
		XV_HELP_DATA, "iconedit:PaletteButton",
		NULL);
	return obj;
}

/*
 * Create object `strip_control' in the specified instance.

 */
Xv_opaque
base_window_strip_control_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL,
		XV_KEY_DATA, INSTANCE, ip,
		WIN_BORDER, FALSE,
		XV_HELP_DATA, "iconedit:Panel",
		NULL);
	return obj;
}

/*
 * Create object `brush_setting' in the specified instance.

 */
Xv_opaque
base_window_brush_setting_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern int		brush_sel();
	Xv_opaque	obj;
	Xv_opaque		brush_setting_image0;
	static unsigned short	brush_setting_bits0[] = {
#include "point.icon16"
	};
	Xv_opaque		brush_setting_image1;
	static unsigned short	brush_setting_bits1[] = {
#include "line.icon16"
	};
	Xv_opaque		brush_setting_image2;
	static unsigned short	brush_setting_bits2[] = {
#include "box.icon16"
	};
	Xv_opaque		brush_setting_image3;
	static unsigned short	brush_setting_bits3[] = {
#include "circle.icon16"
	};
	Xv_opaque		brush_setting_image4;
	static unsigned short	brush_setting_bits4[] = {
#include "ellipse.icon16"
	};
	Xv_opaque		brush_setting_image5;
	static unsigned short	brush_setting_bits5[] = {
#include "lucida.icon16"
	};
	Xv_opaque		brush_setting_image6;
	static unsigned short	brush_setting_bits6[] = {
#include "select_box4.icon16"
	};
	Xv_opaque		brush_setting_image7;
	static unsigned short	brush_setting_bits7[] = {
#include "eraser.icon"
	};
	
	brush_setting_image0 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits0,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image1 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits1,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image2 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits2,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image3 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits3,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image4 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits4,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image5 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits5,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image6 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits6,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	brush_setting_image7 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, brush_setting_bits7,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_CHOICE,
		XV_KEY_DATA, INSTANCE, ip,
		XV_X, xv_col(owner, 0),
		XV_Y, xv_row(owner, 0),
		PANEL_LAYOUT, PANEL_VERTICAL,
		PANEL_CHOICE_NROWS, 2,
		PANEL_NOTIFY_PROC, brush_sel,
		PANEL_CHOICE_IMAGES,
			brush_setting_image0,
			brush_setting_image1,
			brush_setting_image2,
			brush_setting_image3,
			brush_setting_image4,
			brush_setting_image5,
			brush_setting_image6,
			brush_setting_image7,
			0,
		XV_HELP_DATA, "iconedit:BrushSetting",
		NULL);
	return obj;
}

/*
 * Create object `fill_setting' in the specified instance.

 */
Xv_opaque
base_window_fill_setting_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern int		fill_sel();
	Xv_opaque	obj;
	Xv_opaque		fill_setting_image0;
	static unsigned short	fill_setting_bits0[] = {
#include "swatch_white.icon16"
	};
	Xv_opaque		fill_setting_image1;
	static unsigned short	fill_setting_bits1[] = {
#include "swatch_17.icon16"
	};
	Xv_opaque		fill_setting_image2;
	static unsigned short	fill_setting_bits2[] = {
#include "swatch_20.icon16"
	};
	Xv_opaque		fill_setting_image3;
	static unsigned short	fill_setting_bits3[] = {
#include "swatch_25.icon16"
	};
	Xv_opaque		fill_setting_image4;
	static unsigned short	fill_setting_bits4[] = {
#include "swatch_root.icon16"
	};
	Xv_opaque		fill_setting_image5;
	static unsigned short	fill_setting_bits5[] = {
#include "swatch_50.icon16"
	};
	Xv_opaque		fill_setting_image6;
	static unsigned short	fill_setting_bits6[] = {
#include "swatch_75.icon16"
	};
	Xv_opaque		fill_setting_image7;
	static unsigned short	fill_setting_bits7[] = {
#include "swatch_80.icon16"
	};
	Xv_opaque		fill_setting_image8;
	static unsigned short	fill_setting_bits8[] = {
#include "swatch_83.icon16"
	};
	Xv_opaque		fill_setting_image9;
	static unsigned short	fill_setting_bits9[] = {
#include "swatch_black.icon16"
	};
	
	fill_setting_image0 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits0,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image1 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits1,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image2 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits2,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image3 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits3,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image4 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits4,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image5 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits5,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image6 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits6,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image7 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits7,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image8 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits8,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	fill_setting_image9 = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, fill_setting_bits9,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_CHOICE,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LAYOUT, PANEL_VERTICAL,
		PANEL_CHOICE_NROWS, 2,
		PANEL_NOTIFY_PROC, fill_sel,
		PANEL_CHOICE_IMAGES,
			fill_setting_image0,
			fill_setting_image1,
			fill_setting_image2,
			fill_setting_image3,
			fill_setting_image4,
			fill_setting_image5,
			fill_setting_image6,
			fill_setting_image7,
			fill_setting_image8,
			fill_setting_image9,
			0,
		XV_HELP_DATA, "iconedit:FillSetting",
		NULL);
	return obj;
}

/*
 * Create object `color_mono_setting' in the specified instance.

 */
Xv_opaque
base_window_color_mono_setting_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		color_mono_event_handler();
	extern int		color_mono_notify_handler();
	Xv_opaque	obj;
	
	obj = xv_create(owner, PANEL_CHOICE,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 0),
		PANEL_LAYOUT, PANEL_HORIZONTAL,
		PANEL_CHOICE_NCOLS, 1,
		PANEL_NOTIFY_PROC, color_mono_notify_handler,
		PANEL_EVENT_PROC, color_mono_event_handler,
		PANEL_CHOICE_STRINGS,
			 gettext("Color") ,
			 gettext("B&W") ,
			0,
		XV_HELP_DATA, "iconedit:ColorToggle",
		NULL);
	return obj;
}

/*
 * Create object `move_left_bt' in the specified instance.

 */
Xv_opaque
base_window_move_left_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		move_left();
	Xv_opaque	obj;
	Xv_opaque		move_left_bt_image;
	static unsigned short	move_left_bt_bits[] = {
#include "left_arrow.icon"
	};
	
	move_left_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, move_left_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		XV_X, xv_col(owner, 0),
		PANEL_LABEL_IMAGE, move_left_bt_image,
		PANEL_EVENT_PROC, move_left,
		XV_HELP_DATA, "iconedit:MoveLeftButton",
		NULL);
	return obj;
}

/*
 * Create object `move_right_bt' in the specified instance.

 */
Xv_opaque
base_window_move_right_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		move_right();
	Xv_opaque	obj;
	Xv_opaque		move_right_bt_image;
	static unsigned short	move_right_bt_bits[] = {
#include "right_arrow.icon"
	};
	
	move_right_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, move_right_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, move_right_bt_image,
		PANEL_EVENT_PROC, move_right,
		XV_HELP_DATA, "iconedit:MoveRightButton",
		NULL);
	return obj;
}

/*
 * Create object `move_up_bt' in the specified instance.

 */
Xv_opaque
base_window_move_up_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		move_up();
	Xv_opaque	obj;
	Xv_opaque		move_up_bt_image;
	static unsigned short	move_up_bt_bits[] = {
#include "up_arrow.icon"
	};
	
	move_up_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, move_up_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, move_up_bt_image,
		PANEL_EVENT_PROC, move_up,
		XV_HELP_DATA, "iconedit:MoveUpButton",
		NULL);
	return obj;
}

/*
 * Create object `move_down_bt' in the specified instance.

 */
Xv_opaque
base_window_move_down_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		move_down();
	Xv_opaque	obj;
	Xv_opaque		move_down_bt_image;
	static unsigned short	move_down_bt_bits[] = {
#include "down_arrow.icon"
	};
	
	move_down_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, move_down_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, move_down_bt_image,
		PANEL_EVENT_PROC, move_down,
		XV_HELP_DATA, "iconedit:MoveDownButton",
		NULL);
	return obj;
}

/*
 * Create object `horzflip_bt' in the specified instance.

 */
Xv_opaque
base_window_horzflip_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		horz_flip();
	Xv_opaque	obj;
	Xv_opaque		horzflip_bt_image;
	static unsigned short	horzflip_bt_bits[] = {
#include "horzflip_arrow.icon"
	};
	
	horzflip_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, horzflip_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, horzflip_bt_image,
		PANEL_EVENT_PROC, horz_flip,
		XV_HELP_DATA, "iconedit:HorizFlipButton",
		NULL);
	return obj;
}

/*
 * Create object `vertflip_bt' in the specified instance.

 */
Xv_opaque
base_window_vertflip_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		vert_flip();
	Xv_opaque	obj;
	Xv_opaque		vertflip_bt_image;
	static unsigned short	vertflip_bt_bits[] = {
#include "vertflip_arrow.icon"
	};
	
	vertflip_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, vertflip_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, vertflip_bt_image,
		PANEL_EVENT_PROC, vert_flip,
		XV_HELP_DATA, "iconedit:VertFlipButton",
		NULL);
	return obj;
}

/*
 * Create object `counter_rot_bt' in the specified instance.

 */
Xv_opaque
base_window_counter_rot_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		counter_rot();
	Xv_opaque	obj;
	Xv_opaque		counter_rot_bt_image;
	static unsigned short	counter_rot_bt_bits[] = {
#include "counter_rot.icon"
	};
	
	counter_rot_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, counter_rot_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, counter_rot_bt_image,
		PANEL_EVENT_PROC, counter_rot,
		XV_HELP_DATA, "iconedit:RotLeftButton",
		NULL);
	return obj;
}

/*
 * Create object `clock_rot_bt' in the specified instance.

 */
Xv_opaque
base_window_clock_rot_bt_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void		clock_rot();
	Xv_opaque	obj;
	Xv_opaque		clock_rot_bt_image;
	static unsigned short	clock_rot_bt_bits[] = {
#include "clock_rot.icon"
	};
	
	clock_rot_bt_image = xv_create(XV_NULL, SERVER_IMAGE,
		SERVER_IMAGE_BITS, clock_rot_bt_bits,
		SERVER_IMAGE_DEPTH, 1,
		XV_WIDTH, 16,
		XV_HEIGHT, 16,
		NULL);
	obj = xv_create(owner, PANEL_BUTTON,
		XV_KEY_DATA, INSTANCE, ip,
		XV_Y, xv_row(owner, 2),
		PANEL_LABEL_IMAGE, clock_rot_bt_image,
		PANEL_EVENT_PROC, clock_rot,
		XV_HELP_DATA, "iconedit:RotRightButton",
		NULL);
	return obj;
}

/*
 * Create object `preview_canvas' in the specified instance.

 */
Xv_opaque
base_window_preview_canvas_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern void	repaint_preview_canvas();
	extern Notify_value	preview_canvas_event();
	Xv_opaque	obj;
	Xv_Window       paint_win;
	Cms             xview_cms;
	Window          canvas_xwindow;
	Window          cp_xwindow;
	Colormap        cmap;
	XColor          white;
	Display         *dpy;
	unsigned long   xv_black, xv_white;

	xview_cms = (Cms)xv_create(NULL, CMS,
			     CMS_CONTROL_CMS, TRUE,
			     CMS_SIZE, CMS_CONTROL_COLORS + 2,
			     CMS_NAMED_COLORS, "white", "black", NULL,
			     NULL);

	xv_white = (unsigned long)xv_get(xview_cms, CMS_PIXEL, CMS_CONTROL_COLORS + 0);
	xv_black = (unsigned long)xv_get(xview_cms, CMS_PIXEL, CMS_CONTROL_COLORS + 1);

	obj = xv_create(owner, CANVAS,
		XV_KEY_DATA, INSTANCE, ip,
		XV_WIDTH, DEFAULT_PREVIEW_SIZE,
		XV_HEIGHT, DEFAULT_PREVIEW_SIZE,
		WIN_INHERIT_COLORS, FALSE,
		CANVAS_PAINTWINDOW_ATTRS, 
			WIN_CMS, xview_cms,
			WIN_FOREGROUND_COLOR, CMS_CONTROL_COLORS + 1, 
			WIN_BACKGROUND_COLOR, CMS_CONTROL_COLORS + 0,
			NULL,
		CANVAS_REPAINT_PROC, repaint_preview_canvas,
		NULL);

	notify_interpose_event_func(canvas_paint_window(obj),
		(Notify_func) preview_canvas_event, NOTIFY_SAFE);

	return obj;
}

/*
 * Create object `big_bit_canvas' in the specified instance.
 */
Xv_opaque
base_window_big_bit_canvas_create(ip, owner)
	caddr_t		ip;
	Xv_opaque	owner;
{
	extern Notify_value	big_canvas_event();
	extern void	repaint_big_canvas();
	Xv_opaque	obj;
	Cms             xview_cms;
	Window          canvas_xwindow;
	Display         *dpy;
	Colormap        cmap;
	XColor          white;
	unsigned long   xv_black, xv_white;
	
	xview_cms = (Cms)xv_create(NULL, CMS,
			     CMS_CONTROL_CMS, TRUE,
			     CMS_SIZE, CMS_CONTROL_COLORS + 2,
			     CMS_NAMED_COLORS, "white", "black", NULL,
			     NULL);

	xv_white = (unsigned long)xv_get(xview_cms, CMS_PIXEL, CMS_CONTROL_COLORS + 0);
	xv_black = (unsigned long)xv_get(xview_cms, CMS_PIXEL, CMS_CONTROL_COLORS + 1);

	obj = xv_create(owner, CANVAS,
		XV_KEY_DATA, INSTANCE, ip,
		XV_HEIGHT,	DEFAULT_CANVAS_SIZE,
		XV_WIDTH,	DEFAULT_CANVAS_SIZE,
		WIN_INHERIT_COLORS, FALSE,
		CANVAS_PAINTWINDOW_ATTRS, 
			WIN_CMS, xview_cms,
			WIN_FOREGROUND_COLOR, CMS_CONTROL_COLORS + 1, 
			WIN_BACKGROUND_COLOR, CMS_CONTROL_COLORS + 0,
			NULL,
		CANVAS_REPAINT_PROC, repaint_big_canvas,
		NULL);

	canvas_dimension = DEFAULT_CANVAS_SIZE;

	xv_set(canvas_paint_window(obj), WIN_MENU, temp_menu, NULL);
	xv_set(canvas_paint_window(obj), WIN_CONSUME_EVENTS,
		WIN_MOUSE_BUTTONS,
		LOC_DRAG,
		NULL, NULL);
	notify_interpose_event_func(canvas_paint_window(obj),
		(Notify_func) big_canvas_event, NOTIFY_SAFE);
	xv_set(canvas_paint_window(obj), XV_KEY_DATA, INSTANCE, ip, NULL);

	return obj;
}

set_iconedit_label()

{
	char	tool_label[MAXPATHLEN];
	extern	base_window_objects	*base_window;
	extern	Display			*dpy;
	extern	char			*ds_hostname();
	extern	char			*ds_relname();
	char    *filename = (char *) get_truncated_file_name();
	int	file_label = (filename && *filename);
	Menu    file_menu;


	sprintf(tool_label, "%s %s %s%s %s",
		gettext("Icon Editor"),
		ds_relname(),
		ds_hostname(dpy),
		file_label ? filename : (char *) gettext("[None]"),
		Edited  ? (char *) gettext("(Edited)") : "");
		

	file_menu = xv_get(base_window->file_bt, PANEL_ITEM_MENU);

	xv_set(file_menu, MENU_DEFAULT_ITEM,
	       xv_get(file_menu, MENU_NTH_ITEM, Edited ? 2 : 1),
	       NULL);

	xv_set(base_window->window,
		XV_LABEL,  tool_label,
		0);
}

set_iconedit_footer()

{
  char		undo_status_message[256];
  extern	base_window_objects	*base_window;

  sprintf(undo_status_message, 
		gettext("%d X %d, %d undos, %d redos available"), 
	        icon_height,
	        icon_width,
		undos_allowed, 
		redos_allowed);

  xv_set(base_window->window, 
	FRAME_RIGHT_FOOTER, undo_status_message , 
	NULL);

  if (Edited < 2)
    set_iconedit_label();
}

position_color_choosers(ip)

base_window_objects      *ip;

{

	extern Panel_item black_white_toggle;

	Panel_item 	palette_button = ip->palette_bt;
	Window		main_window = ip->window;
	Rect		*item_rect;

	/* relocate the palette button */

	item_rect = (Rect *) xv_get(palette_button, PANEL_ITEM_RECT);
	xv_set(palette_button, XV_X, xv_get(main_window, XV_WIDTH) - item_rect->r_width, 0);

	/* relocate the B & W toggle */

	if (black_white_toggle)
	{
		item_rect = (Rect *) xv_get(black_white_toggle, PANEL_ITEM_RECT);
		xv_set(black_white_toggle, 
			XV_X, xv_get(main_window, XV_WIDTH) - item_rect->r_width, 
			0);
	}

}

Notify_value
iconedit_destroy_proc(client, status)

Notify_client	client;
Destroy_status	status;

{
	int	answer;
  	extern	base_window_objects	*base_window;

	if ((status == DESTROY_CHECKING) && Edited)
	{
    		answer = notice_prompt(base_window->window, NULL,
		  		NOTICE_MESSAGE_STRINGS,
		  		gettext("Your image has been edited.  You may continue,\ndiscarding your edits, or you may cancel your quit."),
		  		0,
		  		NOTICE_BUTTON_YES, gettext("Cancel"),
		  		NOTICE_BUTTON_NO, gettext("Continue"),
		  		0);


		if (answer == NOTICE_YES)
		{
			notify_veto_destroy(client);
			return(NOTIFY_DONE);
		}
	}

	return(notify_next_destroy_func(client, status));

}

Notify_value
iconedit_interpose_proc( frame, event, arg, type )
    Frame	       frame;
    Event             *event;
    Notify_arg         arg;
    Notify_event_type  type;
{
    switch( event_action( event ) ) {
      case ACTION_OPEN:
        iconedit_open_frame();
        break;
      case ACTION_CLOSE:
        iconedit_close_frame();
        break;
      default:
        break;
    }
    return( notify_next_event_func( frame, ( Notify_event )event, arg, type ) );
}

